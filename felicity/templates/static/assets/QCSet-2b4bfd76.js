import{P as me,u as fe,a9 as ge,Z as f,h as F,r as xe,o,c as n,b as t,a1 as W,a2 as y,z as x,a as A,F as u,D as c,E as d,A as p,W as Q,a4 as U,V as J,a7 as he,a5 as Z,J as R,ap as ve,_ as ke}from"./index-d30fd8e2.js";import{u as we}from"./analysis-21d492cc.js";import{h as V,o as S,a as E}from"./constants-cb49b235.js";import"./analyses.mutations-ddd21bab.js";const _e={class:"flex justify-end"},Ue={key:0,class:"overflow-x-auto mt-4"},Ce={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Re={class:"min-w-full"},Ve={class:"bg-white"},Se={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ee={class:"text-sm leading-5 text-gray-800"},$e={class:"flex items-center gap-x-4"},Ie={class:"text-md font-semibold italics text-sky-800"},Ae={class:"text-sm italics text-sky-400"},De=["onUpdate:modelValue","disabled"],Ne={class:"w-3/5"},Te={class:"flex justify-start items-center gap-x-4 px-1 py-1"},qe={key:0,class:"text-sm leading-5 text-sky-800"},Le={key:1,class:"mb-2 w-full"},Be=["onUpdate:modelValue","onChange"],Pe=["value"],Ke={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Me={key:0,class:"text-sm leading-5 text-sky-800"},Qe={key:1,class:"mb-2 w-full"},je=["onUpdate:modelValue","onChange"],Oe=["value"],ze={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Fe={key:0,class:"text-sm leading-5 text-sky-800"},We={key:1,class:"block w-full"},Je=["onUpdate:modelValue","onKeyup"],Ze={key:2,class:"block col-span-2 w-full"},Ge=["onUpdate:modelValue","onChange"],He=["value"],Xe={key:1,class:"overflow-x-auto"},Ye={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},et={class:"min-w-full"},tt={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},st={class:"bg-white"},lt=["onUpdate:modelValue","disabled"],ot={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},nt={class:"text-sm leading-5 text-sky-800"},at={class:"italic text-sm text-gray-400"},rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},it={key:0,class:"text-sm leading-5 text-sky-800"},dt={key:1,class:"block col-span-2 mb-2"},ut=["onUpdate:modelValue","onChange"],yt=["value"],ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},pt={key:0,class:"text-sm leading-5 text-sky-800"},bt={key:1,class:"block col-span-2 mb-2"},mt=["onUpdate:modelValue","onChange"],ft=["value"],gt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},xt={class:"text-sm leading-5 text-sky-800"},ht={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},vt={class:"text-sm leading-5 text-sky-800"},kt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},wt={key:0,class:"text-sm leading-5 text-sky-800"},_t={key:1,class:"block col-span-2 mb-2"},Ut=["onUpdate:modelValue","onChange"],Ct=["value"],Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Vt={key:0,class:"text-sm leading-5 text-sky-800"},St={key:1,class:"block"},Et=["onUpdate:modelValue","onKeyup"],$t={key:2,class:"block col-span-2 mb-2"},It=["onUpdate:modelValue","onChange"],At=["value"],Dt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Nt={class:"text-sm leading-5 text-sky-800"},Tt={key:0,class:"text-sky-800"},qt={key:1,class:"text-orange-600"},Lt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Bt={class:"text-sm leading-5 text-sky-800"},Pt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Kt={class:"text-sm leading-5 text-sky-800"},Mt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Qt={type:"button",class:"p-1 bg-sky-800 text-white rounded-sm leading-none"},jt={class:"my-4"},Ot=me({__name:"QCSet",setup(zt){let h=fe(),G=ge(),I=f(!1),D=f(!1),N=f(!1),T=f(!1),q=f(!1),v=f(!1);h.fetchQCSetByUid(G.params.qcSetUid);let k=F(()=>{let a=h.getQCSet;if(!a)return;let e={levels:[],analytes:[]};return a?.samples?.forEach(i=>{i.assigned||(e.levels.some(l=>l.uid==i?.qcLevel?.uid)||e.levels.push(i?.qcLevel),i?.analysisResults?.forEach(l=>{e.analytes.some(r=>r.uid==l?.analysis?.uid)||e.analytes.push(l?.analysis);const s=e.analytes.findIndex(r=>r.uid==l?.analysis?.uid);e.analytes[s].items?e.analytes[s].items?.some(r=>r.sampleUid===l.sampleUid)||e.analytes[s].items.push({...l,sample:i}):e.analytes[s].items=[{...l,sample:i}]}))}),K("list"),{levels:e.levels,analytes:e.analytes}});function j(){let a=[];return k?.value.analytes?.forEach(e=>e.items.forEach(i=>a.push(i))),a}function H(){let a=[];return k?.value.analytes?(k?.value.analytes?.forEach(e=>{e?.items?.forEach(i=>a.push(i))}),a):[]}function L(){let a=[];return k?.value.analytes?(k?.value.analytes?.forEach(e=>{e?.items?.forEach(i=>{i.checked&&a.push(i)})}),a):[]}function $(){const a=L();let e=[];return a?.forEach(i=>e.push(i.uid)),e}function b(){I.value=!1,D.value=!1,N.value=!1,T.value=!1,q.value=!1;const a=L();a.length!==0&&(a.every(e=>e.status==="cancelled")&&(q.value=!0),a.every(e=>e.status==="pending")&&(I.value=!0),a.every(e=>e.status==="resulted")&&(D.value=!0,N.value=!0,T.value=!0))}function X(){return H()?.every(e=>e.checked===!0)}function m(a){a.checked=!0,b()}function Y(a){a.checked=!1,b()}function ee(){j()?.forEach(e=>v.value?m(e):Y(e)),b()}function O(){X()?v.value=!0:v.value=!1,b()}function te(a){a.editable=!0}function w(a){return a?.editable||ve(a?.result)?["cancelled","verified","retracted","to_be_verified"].includes(a.status)?(a.editable=!1,!1):(te(a),!0):!1}function z(a){switch(a?.status){case"retracted":return!0;case"verified":return a?.reportable===!1;default:return!1}}function se(){let a=L(),e=[];return a?.forEach(i=>e.push({uid:i.uid,result:i.result,laboratoryInstrumentUid:i.laboratoryInstrumentUid,methodUid:i.methodUid})),e}const C=async()=>{const a=F(()=>h.getSample);a.value&&h.fetchSampleStatus(a?.value?.uid)};let{submitResults:le,cancelResults:oe,reInstateResults:ne,approveResults:ae,retractResults:re,retestResults:ie}=we();const de=()=>le(se(),"qcset",h.qcSet?.uid).then(a=>(C(),b())),ue=()=>oe($()).then(a=>(C(),b())),ye=()=>ne($()).then(a=>(C(),b())),ce=()=>ae($(),"qcset",h.qcSet?.uid).then(a=>(C(),b())),pe=()=>re($()).then(a=>(C(),b())),be=()=>ie($()).then(a=>(C(),b()));let g=f(!0),B=f("grid"),P=f(!1);function K(a){let e=[],i=[];h.getQCSet?.samples?.forEach(s=>{i.push(s),s.assigned||s?.analysisResults?.forEach(r=>e.push(r))});for(let s of i){const r=e.filter(M=>M.sampleUid===s.uid);let _=[];if(r?.forEach(M=>_.push(M.analysisUid)),P.value=new Set(_).size!==_.length,P.value===!0)break}P.value?(g.value=!1,B.value="list"):a==="grid"?(g.value=!0,B.value="grid"):(g.value=!1,B.value="list")}return(a,e)=>{const i=xe("font-awesome-icon");return o(),n(u,null,[e[41]||(e[41]=t("hr",null,null,-1)),t("div",_e,[t("button",{class:W(["focus:outline-none",{"fill-current text-gray-900":y(g)===!0},{"fill-current text-gray-200":y(g)===!1}]),onClick:e[0]||(e[0]=x(l=>K("grid"),["prevent"]))},[A(i,{icon:"th"})],2),t("button",{class:W(["focus:outline-none ml-2",{"fill-current text-gray-900":y(g)===!1},{"fill-current text-gray-200":y(g)===!0}]),onClick:e[1]||(e[1]=x(l=>K("list"),["prevent"]))},[A(i,{icon:"th-list"})],2)]),y(g)?(o(),n("section",Ue,[t("div",Ce,[t("table",Re,[t("thead",null,[t("tr",null,[e[12]||(e[12]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1)),e[13]||(e[13]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1)),(o(!0),n(u,null,c(y(k)?.levels,l=>(o(),n("th",{key:l.uid,class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},d(l?.level),1))),128)),e[14]||(e[14]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1))])]),t("tbody",Ve,[(o(!0),n(u,null,c(y(k)?.analytes,l=>(o(),n("tr",{key:l.uid},[e[21]||(e[21]=t("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1)),t("td",Se,[t("div",Ee,d(l?.name),1)]),(o(!0),n(u,null,c(l?.items,s=>(o(),n("td",{key:s.uid,class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[t("div",$e,[t("div",null,[t("div",Ie,d(s?.sample?.qcLevel?.level),1),t("div",Ae,"("+d(s?.status)+")",1),p(t("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":r=>s.checked=r,onChange:e[2]||(e[2]=r=>O()),disabled:z(s)},null,40,De),[[Q,s.checked]])]),t("div",Ne,[t("div",Te,[e[16]||(e[16]=t("h4",{class:"w-28"},"Instrument",-1)),w(s)?(o(),n("label",Le,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.laboratoryInstrumentUid=r,onChange:r=>m(s)},[e[15]||(e[15]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(s.analysis?.instruments,r=>(o(),n(u,{key:r.uid},[(o(!0),n(u,null,c(r.laboratoryInstruments,_=>(o(),n("option",{key:_.uid,value:_.uid},d(_.labName)+" → ("+d(r?.name)+") ",9,Pe))),128))],64))),128))],40,Be),[[U,s.laboratoryInstrumentUid]])])):(o(),n("div",qe,d(s.laboratoryInstrument?.labName),1))]),t("div",Ke,[e[18]||(e[18]=t("h4",{class:"w-28"},"Method",-1)),w(s)?(o(),n("label",Qe,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.methodUid=r,onChange:r=>m(s)},[e[17]||(e[17]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(s.analysis?.methods,r=>(o(),n("option",{key:r.uid,value:r.uid},d(r.name),9,Oe))),128))],40,je),[[U,s.methodUid]])])):(o(),n("div",Me,d(s.method?.name),1))]),t("div",ze,[e[20]||(e[20]=t("h4",{class:"w-28"},"Result",-1)),w(s)?s?.analysis?.resultOptions?.length>0?(o(),n("label",We,[p(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.result=r,onKeyup:r=>m(s)},null,40,Je),[[J,s.result]])])):(o(),n("label",Ze,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":r=>s.result=r,onChange:r=>m(s)},[e[19]||(e[19]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(s?.analysis?.resultOptions,r=>(o(),n("option",{key:r.optionKey,value:r.value},d(r.value),9,He))),128))],40,Ge),[[U,s.result]])])):(o(),n("div",Fe,d(s?.result),1))])])])]))),128))]))),128))])])])])):(o(),n("section",Xe,[t("div",Ye,[t("table",et,[t("thead",null,[t("tr",null,[t("th",tt,[p(t("input",{type:"checkbox",onChange:e[3]||(e[3]=l=>ee()),"onUpdate:modelValue":e[4]||(e[4]=l=>he(v)?v.value=l:v=l)},null,544),[[Q,y(v)]])]),e[22]||(e[22]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1)),e[23]||(e[23]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},"Analysis",-1)),e[24]||(e[24]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Methods",-1)),e[25]||(e[25]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Instrument ",-1)),e[26]||(e[26]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Analyst",-1)),e[27]||(e[27]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Reviewer",-1)),e[28]||(e[28]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Interims ",-1)),e[29]||(e[29]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Result",-1)),e[30]||(e[30]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Retest",-1)),e[31]||(e[31]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Submitted",-1)),e[32]||(e[32]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Reviewed",-1)),e[33]||(e[33]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"},"Status",-1)),e[34]||(e[34]=t("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1))])]),t("tbody",st,[(o(!0),n(u,null,c(j(),l=>(o(),n("tr",{key:l.uid},[t("td",null,[p(t("input",{type:"checkbox",class:"","onUpdate:modelValue":s=>l.checked=s,onChange:e[5]||(e[5]=s=>O()),disabled:z(l)},null,40,lt),[[Q,l.checked]])]),e[39]||(e[39]=t("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1)),t("td",ot,[t("div",nt,d(l.analysis?.name),1),t("div",at,"("+d(l?.sample?.qcLevel?.level)+")",1)]),t("td",rt,[w(l)?(o(),n("label",dt,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>l.laboratoryInstrumentUid=s,onChange:s=>m(l)},[e[35]||(e[35]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(l.analysis?.instruments,s=>(o(),n(u,{key:s.uid},[(o(!0),n(u,null,c(s.laboratoryInstruments,r=>(o(),n("option",{key:r.uid,value:r.uid},d(r.labName)+" → ("+d(s?.name)+") ",9,yt))),128))],64))),128))],40,ut),[[U,l.laboratoryInstrumentUid]])])):(o(),n("div",it,d(l.laboratoryInstrument?.labName||"---"),1))]),t("td",ct,[w(l)?(o(),n("label",bt,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>l.methodUid=s,onChange:s=>m(l)},[e[36]||(e[36]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(l.analysis?.methods,s=>(o(),n("option",{key:s.uid,value:s.uid},d(s.name),9,ft))),128))],40,mt),[[U,l.methodUid]])])):(o(),n("div",pt,d(l.method?.name),1))]),t("td",gt,[t("div",xt,d(`${l.submittedBy?.firstName??"--"} ${l.submittedBy?.lastName??"--"}`),1)]),t("td",ht,[t("div",vt,[(o(!0),n(u,null,c(l.verifiedBy,s=>(o(),n("span",{key:s.firstName,class:"ml-1"},d(`${s?.firstName??"--"} ${s?.lastName??"--"},`),1))),128))])]),t("td",kt,[!w(l)||l?.analysis?.interims?.length===0?(o(),n("div",wt," --- ")):(o(),n("label",_t,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>l.result=s,onChange:s=>m(l)},[e[37]||(e[37]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(l?.analysis?.interims,s=>(o(),n("option",{key:s.key,value:s.value},d(s.value),9,Ct))),128))],40,Ut),[[U,l.result]])]))]),t("td",Rt,[w(l)?l?.analysis?.resultOptions?.length===0?(o(),n("label",St,[p(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>l.result=s,onKeyup:s=>m(l)},null,40,Et),[[J,l.result]])])):(o(),n("label",$t,[p(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>l.result=s,onChange:s=>m(l)},[e[38]||(e[38]=t("option",{value:""},null,-1)),(o(!0),n(u,null,c(l?.analysis?.resultOptions,s=>(o(),n("option",{key:s.optionKey,value:s.value},d(s.value),9,At))),128))],40,It),[[U,l.result]])])):(o(),n("div",Vt,d(l?.result),1))]),t("td",Dt,[t("div",Nt,[l?.retest?(o(),n("span",Tt,[A(i,{icon:"fa-check-circle"})])):(o(),n("span",qt,[A(i,{icon:"fa-times-circle"})]))])]),t("td",Lt,[t("div",Bt,d(y(Z)(l?.dateSubmitted)),1)]),t("td",Pt,[t("div",Kt,d(y(Z)(l?.dateVerified)),1)]),t("td",Mt,[t("button",Qt,d(l.status),1)]),e[40]||(e[40]=t("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},null,-1))]))),128))])])])])),t("section",jt,[V(E.UPDATE,S.RESULT)&&y(I)?(o(),n("button",{key:0,onClick:e[6]||(e[6]=x(l=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Cancel ")):R("",!0),V(E.UPDATE,S.RESULT)&&y(q)?(o(),n("button",{key:1,onClick:e[7]||(e[7]=x(l=>ye(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Re-Instate ")):R("",!0),V(E.UPDATE,S.RESULT)&&y(I)?(o(),n("button",{key:2,onClick:e[8]||(e[8]=x(l=>de(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ")):R("",!0),V(E.UPDATE,S.RESULT)&&y(D)?(o(),n("button",{key:3,onClick:e[9]||(e[9]=x(l=>pe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ")):R("",!0),V(E.UPDATE,S.RESULT)&&y(N)?(o(),n("button",{key:4,onClick:e[10]||(e[10]=x(l=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Verify ")):R("",!0),V(E.UPDATE,S.RESULT)&&y(T)?(o(),n("button",{key:5,onClick:e[11]||(e[11]=x(l=>be(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retest ")):R("",!0)])],64)}}}),Gt=ke(Ot,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/qcontrol/_id/QCSet.vue"]]);export{Gt as default};
