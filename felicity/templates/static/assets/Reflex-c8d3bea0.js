import{P as me,e as fe,a9 as ve,Z as h,f as X,aa as ye,r as xe,o as n,c as i,b as t,E as y,a2 as a,F as m,D as v,a as S,K as U,L as be,x as Y,A as x,V as B,a4 as w,z as k,a7 as z,J as H,X as J,S as ge,Y as K,ah as ke,_ as he}from"./index-66877f9a.js";import{u as we,D as _e,a as Re,b as Ce,c as Ae,d as Ue}from"./reflex.mutations-14e9e02d.js";import{u as Be}from"./analysis-793745a0.js";const Ve={class:"mt-4 mb-2 text-xl text-gray-600 font-semibold tracking-wide"},De={class:"leading-2 text-md italic tracking-wide"},Se=["onClick"],Ee={class:"flex justify-start items-center mb-2"},Ne=["onClick"],$e={class:"grid grid-cols-3 gap-4"},Fe={class:"flex justify-between items-center"},Oe={class:"my-2 text-l text-gray-600 font-bold"},je=["onClick"],Te=["onClick"],Me={class:"text-gray-500 text-sm"},Le={action:"post",class:"p-1"},Pe={class:"grid grid-cols-2 gap-x-4 mb-4"},qe={class:"block col-span-1 mb-2"},Xe={class:"block col-span-2 mb-2"},Ye=["value"],ze={class:"block col-span-2 mb-2"},He={action:"post",class:"p-1"},Je={class:"mb-2"},Ke={class:"flex items-center justify-start my-4 font-bold text-l text-gray-600"},We={class:"grid grid-cols-2 gap-4 my-4"},Ze={class:"flex justify-between items-center"},Ge={class:"flex justify-start items-center py-2"},Ie=["onClick"],Qe=["onClick"],et={class:"flex items-center justify-between"},tt={class:"flex items-bottom gap-x-2"},st={class:"flex flex-col whitespace-nowrap mb-2"},ot=["onUpdate:modelValue","onChange"],nt=["value"],lt={class:"flex flex-col whitespace-nowrap mb-2"},it=["onUpdate:modelValue"],at={class:"block col-span-1 mt-1"},rt=["onUpdate:modelValue"],ut=["onUpdate:modelValue"],dt=["value"],pt={class:""},ct=["onClick"],mt={class:"flex justify-start items-center py-2"},ft=["onClick"],vt={class:"flex items-center justify-between"},yt={class:"flex items-top gap-x-4"},xt={class:"flex flex-col whitespace-nowrap mb-2"},bt=["onUpdate:modelValue"],gt=["value"],kt={class:"block col-span-1 mb-2"},ht=["onUpdate:modelValue"],wt={class:""},_t=["onClick"],Rt={class:"flex justify-start items-center py-2"},Ct=["onClick"],At={class:"flex items-center justify-between"},Ut={class:"flex items-top gap-x-4"},Bt={class:"flex flex-col whitespace-nowrap mb-2"},Vt=["onUpdate:modelValue","onChange"],Dt=["value"],St={class:"block col-span-1 mb-2"},Et=["onUpdate:modelValue"],Nt=["onUpdate:modelValue"],$t=["value"],Ft={class:""},Ot=["onClick"],jt=me({__name:"Reflex",setup(Tt){const O=J(()=>K(()=>import("./index-66877f9a.js").then(s=>s.cN),["assets/index-66877f9a.js","assets/index-78b87750.css"])),W=J(()=>K(()=>import("./FelAccordion-418ec686.js"),["assets/FelAccordion-418ec686.js","assets/index-66877f9a.js","assets/index-78b87750.css"])),b=we(),Z=Be(),{withClientMutation:V}=fe(),G=ve();let _=h(!1),D=h(""),f=X({});const R=h(!0);let C=h(!1),u=X({description:"",priority:0,conditions:[],actions:[]});ye(async()=>{b.fetchReflexRuleByUid(G.params?.uid)});const I=s=>{const e=ke(s);return e.charAt(0).toUpperCase()+e.slice(1)},A=Z.getAnalysesServicesSimple;function Q(){const s={reflexRuleUid:b.reflexRule?.uid,level:f.level,description:f.description,analyses:f.analyses};V(Re,{payload:s},"createReflexAction").then(e=>b.addReflexAction(e))}function ee(){const s={reflexRuleUid:b.reflexRule?.uid,level:f.level,description:f.description,analyses:f.analyses};V(Ce,{uid:f.uid,payload:s},"updateReflexAction").then(e=>b.updateReflexAction(e))}function j(s,e={}){if(R.value=s,_.value=!0,D.value=(s?"CREATE":"EDIT")+" REFLEX ACTION",s)Object.assign(f,{});else{let r=[];e.analyses?.forEach(o=>r.push(o?.uid)),Object.assign(f,{...e,analyses:r})}}function te(){R.value===!0&&Q(),R.value===!1&&ee(),_.value=!1}const E=h();function se(){const s={...u,reflexActionUid:E.value};V(Ae,{payload:s},"createReflexBrain").then(e=>b.updateReflexBrain(e))}function oe(){const s={reflexActionUid:E.value,priority:u.priority,description:u.description,conditions:u.conditions?.map(e=>({description:e.description,priority:e.priority,criteria:e.criteria?.map(r=>({analysisUid:r.analysisUid,operator:r.operator,value:r.value}))})),actions:u.actions?.map(e=>({addNew:e.addNew?.map(r=>({analysisUid:r.analysisUid,count:r.count})),finalise:e.finalise?.map(r=>({analysisUid:r.analysisUid,value:r.value}))}))};V(Ue,{uid:u.uid,payload:s},"updateReflexBrain").then(e=>b.updateReflexBrain(e))}function T(){u.conditions?.push({description:"",priority:0,criteria:[]})}function ne(s){u.conditions?.splice(s,1)}function le(){u.actions?.push({addNew:[],finalise:[]})}function M(s){u.conditions[s].criteria?.push({operator:"eq"})}function ie(s,e){u.conditions[s].criteria?.splice(e,1)}let N=h([]);function ae(s,e){const r=A?.find(o=>o.uid===e.analysisUid);e.value=void 0,N.value=r?.resultOptions||[]}function L(s){u.actions[s]?.addNew?.push({})}function re(s){u.actions[0]?.addNew?.splice(s,1)}function P(s){u.actions[0]?.finalise?.push({})}function ue(s){u.actions[s]?.finalise?.splice(s,1)}let $=h([]);function de(s,e){const r=A?.find(o=>o.uid===e.analysisUid);e.value=void 0,$.value=r?.resultOptions||[]}function q(s,e,r={}){R.value=s,C.value=!0,D.value=(s?"CREATE":"EDIT")+" REFLEX BRAIN",E.value=e,s?(Object.assign(u,{priority:0,description:"",conditions:[],actions:[]}),T(),M(0),le(),L(0),P()):Object.assign(u,{...r})}function pe(){R.value===!0&&se(),R.value===!1&&oe(),C.value=!1}function ce(s,e){ge.fire({title:"Are you sure?",text:"You won't be able to revert this!",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes, delete it!"}).then(r=>{r.isConfirmed&&V(_e,{uid:e},"deleteReflexBrain").then(o=>b.deleteReflexBrain(s,e))})}return(s,e)=>{const r=xe("font-awesome-icon");return n(),i(m,null,[t("h3",Ve,y(a(b).reflexRule?.name),1),t("p",De,y(a(b).reflexRule?.description),1),e[45]||(e[45]=t("hr",null,null,-1)),t("button",{onClick:e[0]||(e[0]=o=>j(!0)),class:"my-4 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Add Reflex Action "),e[46]||(e[46]=t("hr",null,null,-1)),(n(!0),i(m,null,v(a(b).reflexRule?.reflexActions,o=>(n(),i("section",{class:"col-span-1",key:o?.uid},[S(a(W),null,{title:U(()=>[t("span",{class:"p-2",onClick:c=>j(!1,o)},[S(r,{icon:"edit",class:"text-md text-gray-400 mr-1"})],8,Se),be(" Reflex Action Level "+y(o?.level)+" targeting ",1),(n(!0),i(m,null,v(o?.analyses,c=>(n(),i("span",{key:c.uid,class:"ml-1"},y(c?.name)+",",1))),128))]),body:U(()=>[t("div",Ee,[e[10]||(e[10]=t("h4",{class:"text-l leading-4 italic"},"Reflex Action Brains",-1)),t("button",{onClick:c=>q(!0,o?.uid,{}),class:"ml-4 px-2 py-1 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Add Brain ",8,Ne)]),t("div",$e,[(n(!0),i(m,null,v(o?.brains,(c,d)=>(n(),i("div",{key:c?.uid,class:"block col-span-1 bg-white py-2 px-4 m"},[t("div",Fe,[t("h2",Oe,y(I(d+1))+" Brain ",1),t("div",null,[t("span",{class:"p-2",onClick:g=>q(!1,o.uid,c)},[S(r,{icon:"edit",class:"text-md text-gray-400 mr-1"})],8,je),t("span",{class:"p-2",onClick:g=>ce(o.uid,c.uid)},[S(r,{icon:"trash",class:"text-md text-red-400 mr-1"})],8,Te)])]),t("p",Me,y(c?.description),1)]))),128))])]),_:2},1024)]))),128)),a(_)?(n(),Y(a(O),{key:0,onClose:e[5]||(e[5]=o=>z(_)?_.value=!1:_=!1)},{header:U(()=>[t("h3",null,y(a(D)),1)]),body:U(()=>[t("form",Le,[t("div",Pe,[t("label",qe,[e[11]||(e[11]=t("span",{class:"text-gray-700"},"Level",-1)),x(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":e[1]||(e[1]=o=>a(f).level=o),type:"number",min:"1",placeholder:"Name ..."},null,512),[[B,a(f).level]])]),t("label",Xe,[e[13]||(e[13]=t("span",{class:"text-gray-700"},"Target Analyses",-1)),x(t("select",{name:"analyses",id:"analyses","onUpdate:modelValue":e[2]||(e[2]=o=>a(f).analyses=o),class:"form-input mt-1 block w-full",multiple:""},[e[12]||(e[12]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a(A),o=>(n(),i("option",{key:o.uid,value:o.uid},y(o.name),9,Ye))),128))],512),[[w,a(f).analyses]])]),t("label",ze,[e[14]||(e[14]=t("span",{class:"text-gray-700"},"Description",-1)),x(t("textarea",{cols:"2",class:"form-input mt-1 block w-full","onUpdate:modelValue":e[3]||(e[3]=o=>a(f).description=o),placeholder:"Description ..."},null,512),[[B,a(f).description]])])]),e[15]||(e[15]=t("hr",null,null,-1)),t("button",{type:"button",onClick:e[4]||(e[4]=k(o=>te(),["prevent"])),class:"-mb-4 w-full border border-sky-800 bg-sky-800 text-white rounded-sm px-4 py-2 m-2 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline"}," Save Form ")])]),_:1})):H("",!0),a(C)?(n(),Y(a(O),{key:1,onClose:e[9]||(e[9]=o=>z(C)?C.value=!1:C=!1),contentWidth:"w-4/5"},{header:U(()=>[t("h3",null,y(a(D)),1)]),body:U(()=>[t("form",He,[t("label",Je,[e[16]||(e[16]=t("span",{class:"text-gray-700"},"Description",-1)),x(t("textarea",{cols:"2",class:"form-input mt-1 block w-full","onUpdate:modelValue":e[6]||(e[6]=o=>a(u).description=o),placeholder:"Description ..."},null,512),[[B,a(u).description]])]),t("h3",Ke,[e[17]||(e[17]=t("span",null,"Conditions (OR)",-1)),t("button",{onClick:e[7]||(e[7]=k(o=>T(),["prevent"])),class:"px-2 py-1 ml-4 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Add ")]),e[41]||(e[41]=t("p",{class:"italic text-sm text-gray-400"},"Criteria under a condition are evaluated as AND whilst conditions are evaluated as OR",-1)),t("div",We,[(n(!0),i(m,null,v(a(u).conditions,(o,c)=>(n(),i("section",{class:"bg-slate-100 px-1",id:"criteria",key:c},[e[26]||(e[26]=t("hr",null,null,-1)),t("div",Ze,[t("div",Ge,[e[18]||(e[18]=t("h5",null,"Criteria (AND)",-1)),t("button",{onClick:k(d=>M(c),["prevent"]),class:"px-2 py-1 ml-4 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," + criteria ",8,Ie)]),t("button",{onClick:k(d=>ne(c),["prevent"]),class:"px-2 py-1 mr-2 border-orange-600 border text-orange-600rounded-smtransition duration-300 hover:bg-orange-600 hover:text-white focus:outline-none"}," - condition ",8,Qe)]),e[27]||(e[27]=t("hr",{class:"mb-4"},null,-1)),(n(!0),i(m,null,v(o.criteria,(d,g)=>(n(),i("div",{key:g},[t("div",et,[t("div",tt,[t("label",st,[e[20]||(e[20]=t("span",{class:"text-gray-700"},"Analysis",-1)),x(t("select",{name:"analysisService",id:"analysisService","onUpdate:modelValue":l=>d.analysisUid=l,class:"form-input mt-1",onChange:l=>ae(l,d)},[e[19]||(e[19]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a(A),l=>(n(),i("option",{key:l.uid,value:l.uid},y(l.name),9,nt))),128))],40,ot),[[w,d.analysisUid]])]),t("label",lt,[e[22]||(e[22]=t("span",{class:"text-white"},".",-1)),x(t("select",{name:"operator",id:"operator","onUpdate:modelValue":l=>d.operator=l,class:"form-input mt-1"},[...e[21]||(e[21]=[t("option",{value:"eq"},"=",-1),t("option",{value:"gt"},">",-1),t("option",{value:"lt"},"<",-1),t("option",{value:"neq"},"â‰ ",-1)])],8,it),[[w,d.operator]])]),t("label",at,[e[24]||(e[24]=t("span",{class:"text-gray-700"},"Result",-1)),a(N).length==0?x((n(),i("input",{key:0,class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>d.value=l,type:"text",placeholder:"Result ..."},null,8,rt)),[[B,d.value]]):x((n(),i("select",{key:1,name:"criteriaValue",id:"criteriaValue","onUpdate:modelValue":l=>d.value=l,class:"form-input"},[e[23]||(e[23]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a(N),l=>(n(),i("option",{key:l.uid,value:l.value},y(l.value),9,dt))),128))],8,ut)),[[w,d.value]])])]),t("div",pt,[t("button",{onClick:k(l=>ie(c,g),["prevent"]),class:"px-2 py-1 mt-5 ml-2 border-orange-600 border text-orange-600rounded-smtransition duration-300 hover:bg-orange-600 hover:text-white focus:outline-none"}," - criteria ",8,ct)])]),e[25]||(e[25]=t("hr",null,null,-1))]))),128))]))),128))]),e[42]||(e[42]=t("h3",{class:"mt-4 font-bold text-l text-gray-600"},"Actions",-1)),e[43]||(e[43]=t("p",{class:"italic text-sm text-gray-400"},"If conditions are met, auto create new analyses and or set final results",-1)),(n(!0),i(m,null,v(a(u).actions,(o,c)=>(n(),i("section",{class:"grid grid-cols-2 gap-x-4 my-4",key:c},[(n(!0),i(m,null,v(o.addNew,(d,g)=>(n(),i("div",{class:"bg-green-50 px-1",key:g},[t("div",mt,[e[28]||(e[28]=t("h5",null,"Create Analyses",-1)),e[29]||(e[29]=t("span",{class:"text-orange-600"},null,-1)),t("button",{onClick:k(l=>L(g),["prevent"]),class:"px-2 py-1 ml-4 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Add ",8,ft)]),e[33]||(e[33]=t("hr",null,null,-1)),t("div",vt,[t("div",yt,[t("label",xt,[e[31]||(e[31]=t("span",{class:"text-gray-700"},"Analysis",-1)),x(t("select",{name:"analysisService",id:"analysisService","onUpdate:modelValue":l=>d.analysisUid=l,class:"form-input mt-1"},[e[30]||(e[30]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a(A),l=>(n(),i("option",{key:l.uid,value:l.uid},y(l.name),9,gt))),128))],8,bt),[[w,d.analysisUid]])]),t("label",kt,[e[32]||(e[32]=t("span",{class:"text-gray-700"},"Count",-1)),x(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>d.count=l,type:"number",placeholder:"How Many ...",default:"1"},null,8,ht),[[B,d.count]])])]),t("div",wt,[t("button",{onClick:k(l=>re(g),["prevent"]),class:"px-2 py-1 mr-2 border-orange-600 border text-orange-600rounded-smtransition duration-300 hover:bg-orange-600 hover:text-white focus:outline-none"}," Remove ",8,_t)])])]))),128)),(n(!0),i(m,null,v(a(u).actions,(d,g)=>(n(),i("div",{key:g},[(n(!0),i(m,null,v(d.finalise,(l,F)=>(n(),i("div",{class:"bg-orange-50 px-1",key:F},[t("div",Rt,[e[34]||(e[34]=t("h5",null,"Set Final Analyses",-1)),e[35]||(e[35]=t("span",{class:"text-orange-600"},null,-1)),t("button",{onClick:k(p=>P(F),["prevent"]),class:"px-2 py-1 ml-4 mr-2 border-sky-800 border text-sky-800 rounded-sm transition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Add ",8,Ct)]),e[40]||(e[40]=t("hr",null,null,-1)),t("div",At,[t("div",Ut,[t("label",Bt,[e[37]||(e[37]=t("span",{class:"text-gray-700"},"Analysis",-1)),x(t("select",{name:"analysisService",id:"analysisService","onUpdate:modelValue":p=>l.analysisUid=p,class:"form-input mt-1",onChange:p=>de(p,l)},[e[36]||(e[36]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a(A),p=>(n(),i("option",{key:p.uid,value:p.uid},y(p.name),9,Dt))),128))],40,Vt),[[w,l.analysisUid]])]),t("label",St,[e[39]||(e[39]=t("span",{class:"text-gray-700"},"Result",-1)),a($).length==0?x((n(),i("input",{key:0,class:"form-input mt-1 block w-full","onUpdate:modelValue":p=>l.value=p,type:"text",placeholder:"Result ..."},null,8,Et)),[[B,l.value]]):x((n(),i("select",{key:1,name:"finalValue",id:"finalValue","onUpdate:modelValue":p=>l.value=p,class:"form-input mt-1"},[e[38]||(e[38]=t("option",{value:""},null,-1)),(n(!0),i(m,null,v(a($),p=>(n(),i("option",{key:p.uid,value:p.value},y(p.value),9,$t))),128))],8,Nt)),[[w,l.value]])])]),t("div",Ft,[t("button",{onClick:k(p=>ue(F),["prevent"]),class:"px-2 py-1 mr-2 border-orange-600 border text-orange-600rounded-smtransition duration-300 hover:bg-orange-600 hover:text-white focus:outline-none"}," Remove ",8,Ot)])])]))),128))]))),128))]))),128)),e[44]||(e[44]=t("hr",null,null,-1)),t("button",{type:"button",onClick:e[8]||(e[8]=k(o=>pe(),["prevent"])),class:"-mb-4 border border-sky-800 bg-sky-800 text-white rounded-sm px-4 py-2 m-2 transition-colors duration-500 ease select-none hover:bg-sky-800 focus:outline-none focus:shadow-outline"}," Save ")])]),_:1})):H("",!0)],64)}}}),qt=he(jt,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/admin/reflex/_id/Reflex.vue"]]);export{qt as default};
