import{S as fe,u as ye,a6 as ve,a0 as y,i as F,r as xe,o as r,c as n,N as t,a3 as H,a5 as p,A as x,a as A,F as u,E as c,H as d,C as b,Y as Q,a2 as U,X as W,ad as he,K as R,am as ge,_ as ke}from"./index-628f1f8f.js";import{p as X}from"./index-1c874f2e.js";import{u as _e}from"./analysis-3887455a.js";import{h as S,o as V,a as E}from"./constants-969a8be0.js";import"./analyses.mutations-ee5b99ac.js";const we={class:"flex justify-end"},Ue={key:0,class:"overflow-x-auto mt-4"},Ce={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-background shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Re={class:"min-w-full"},Se={class:"bg-background"},Ve={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},Ee={class:"text-sm leading-5 text-foreground"},$e={class:"flex items-center gap-x-4"},Ie={class:"text-md font-semibold italics text-primary"},Ae={class:"text-sm italics text-primary"},Ne=["onUpdate:modelValue","disabled"],De={class:"w-3/5"},Te={class:"flex justify-start items-center gap-x-4 px-1 py-1"},qe={key:0,class:"text-sm leading-5 text-primary"},Le={key:1,class:"mb-2 w-full"},Be=["onUpdate:modelValue","onChange"],Ke=["value"],Pe={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Me={key:0,class:"text-sm leading-5 text-primary"},Qe={key:1,class:"mb-2 w-full"},je=["onUpdate:modelValue","onChange"],Oe=["value"],ze={class:"flex justify-start items-center gap-x-4 px-1 py-1"},Fe={key:0,class:"text-sm leading-5 text-primary"},He={key:1,class:"block w-full"},We=["onUpdate:modelValue","onKeyup"],Xe={key:2,class:"block col-span-2 w-full"},Ye=["onUpdate:modelValue","onChange"],Ge=["value"],Je={key:1,class:"overflow-x-auto"},Ze={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-background shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},et={class:"min-w-full"},tt={class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},st={class:"bg-background"},ot=["onUpdate:modelValue","disabled"],rt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},nt={class:"text-sm leading-5 text-primary"},lt={class:"italic text-sm text-muted-foreground"},at={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},it={key:0,class:"text-sm leading-5 text-primary"},dt={key:1,class:"block col-span-2 mb-2"},ut=["onUpdate:modelValue","onChange"],pt=["value"],ct={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},bt={key:0,class:"text-sm leading-5 text-primary"},mt={key:1,class:"block col-span-2 mb-2"},ft=["onUpdate:modelValue","onChange"],yt=["value"],vt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},xt={class:"text-sm leading-5 text-primary"},ht={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},gt={class:"text-sm leading-5 text-primary"},kt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},_t={key:0,class:"text-sm leading-5 text-primary"},wt={key:1,class:"block col-span-2 mb-2"},Ut=["onUpdate:modelValue","onChange"],Ct=["value"],Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},St={key:0,class:"text-sm leading-5 text-primary"},Vt={key:1,class:"block"},Et=["onUpdate:modelValue","onKeyup"],$t={key:2,class:"block col-span-2 mb-2"},It=["onUpdate:modelValue","onChange"],At=["value"],Nt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},Dt={class:"text-sm leading-5 text-primary"},Tt={key:0,class:"text-primary"},qt={key:1,class:"text-destructive"},Lt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},Bt={class:"text-sm leading-5 text-primary"},Kt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},Pt={class:"text-sm leading-5 text-primary"},Mt={class:"px-1 py-1 whitespace-no-wrap border-b border-border"},Qt={type:"button",class:"p-1 bg-primary text-primary-foreground rounded-sm leading-none"},jt={class:"my-4"},Ot=fe({__name:"QCSet",setup(zt){let h=ye(),Y=ve(),I=y(!1),N=y(!1),D=y(!1),T=y(!1),q=y(!1),g=y(!1);h.fetchQCSetByUid(Y.params.qcSetUid);let k=F(()=>{let l=h.getQCSet;if(!l)return;let e={levels:[],analytes:[]};return l?.samples?.forEach(i=>{i.assigned||(e.levels.some(o=>o.uid==i?.qcLevel?.uid)||e.levels.push(i?.qcLevel),i?.analysisResults?.forEach(o=>{e.analytes.some(a=>a.uid==o?.analysis?.uid)||e.analytes.push(o?.analysis);const s=e.analytes.findIndex(a=>a.uid==o?.analysis?.uid);e.analytes[s].items?e.analytes[s].items?.some(a=>a.sampleUid===o.sampleUid)||e.analytes[s].items.push({...o,sample:i}):e.analytes[s].items=[{...o,sample:i}]}))}),P("list"),{levels:e.levels,analytes:e.analytes}});function j(){let l=[];return k?.value.analytes?.forEach(e=>e.items.forEach(i=>l.push(i))),l}function G(){let l=[];return k?.value.analytes?(k?.value.analytes?.forEach(e=>{e?.items?.forEach(i=>l.push(i))}),l):[]}function L(){let l=[];return k?.value.analytes?(k?.value.analytes?.forEach(e=>{e?.items?.forEach(i=>{i.checked&&l.push(i)})}),l):[]}function $(){const l=L();let e=[];return l?.forEach(i=>e.push(i.uid)),e}function m(){I.value=!1,N.value=!1,D.value=!1,T.value=!1,q.value=!1;const l=L();l.length!==0&&(l.every(e=>e.status==="cancelled")&&(q.value=!0),l.every(e=>e.status==="pending")&&(I.value=!0),l.every(e=>e.status==="resulted")&&(N.value=!0,D.value=!0,T.value=!0))}function J(){return G()?.every(e=>e.checked===!0)}function f(l){l.checked=!0,m()}function Z(l){l.checked=!1,m()}function ee(){j()?.forEach(e=>g.value?f(e):Z(e)),m()}function O(){J()?g.value=!0:g.value=!1,m()}function te(l){l.editable=!0}function _(l){return l?.editable||ge(l?.result)?["cancelled","verified","retracted","to_be_verified"].includes(l.status)?(l.editable=!1,!1):(te(l),!0):!1}function z(l){switch(l?.status){case"retracted":return!0;case"verified":return l?.reportable===!1;default:return!1}}function se(){let l=L(),e=[];return l?.forEach(i=>e.push({uid:i.uid,result:i.result,laboratoryInstrumentUid:i.laboratoryInstrumentUid,methodUid:i.methodUid})),e}const C=async()=>{const l=F(()=>h.getSample);l.value&&h.fetchSampleStatus(l?.value?.uid)};let{submitResults:oe,cancelResults:re,reInstateResults:ne,approveResults:le,retractResults:ae,retestResults:ie}=_e();const de=()=>oe(se(),"qcset",h.qcSet?.uid).then(l=>(C(),m())),ue=()=>re($()).then(l=>(C(),m())),pe=()=>ne($()).then(l=>(C(),m())),ce=()=>le($(),"qcset",h.qcSet?.uid).then(l=>(C(),m())),be=()=>ae($()).then(l=>(C(),m())),me=()=>ie($()).then(l=>(C(),m()));let v=y(!0),B=y("grid"),K=y(!1);function P(l){let e=[],i=[];h.getQCSet?.samples?.forEach(s=>{i.push(s),s.assigned||s?.analysisResults?.forEach(a=>e.push(a))});for(let s of i){const a=e.filter(M=>M.sampleUid===s.uid);let w=[];if(a?.forEach(M=>w.push(M.analysisUid)),K.value=new Set(w).size!==w.length,K.value===!0)break}K.value?(v.value=!1,B.value="list"):l==="grid"?(v.value=!0,B.value="grid"):(v.value=!1,B.value="list")}return(l,e)=>{const i=xe("font-awesome-icon");return r(),n(u,null,[e[41]||(e[41]=t("hr",null,null,-1)),t("div",we,[t("button",{class:H(["focus:outline-none",{"fill-current text-foreground":p(v)===!0},{"fill-current text-muted-foreground":p(v)===!1}]),onClick:e[0]||(e[0]=x(o=>P("grid"),["prevent"]))},[A(i,{icon:"th"})],2),t("button",{class:H(["focus:outline-none ml-2",{"fill-current text-foreground":p(v)===!1},{"fill-current text-muted-foreground":p(v)===!0}]),onClick:e[1]||(e[1]=x(o=>P("list"),["prevent"]))},[A(i,{icon:"th-list"})],2)]),p(v)?(r(),n("section",Ue,[t("div",Ce,[t("table",Re,[t("thead",null,[t("tr",null,[e[12]||(e[12]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},null,-1)),e[13]||(e[13]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"}," Analysis ",-1)),(r(!0),n(u,null,c(p(k)?.levels,o=>(r(),n("th",{key:o.uid,class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},d(o?.level),1))),128)),e[14]||(e[14]=t("th",{class:"px-1 py-1 border-b-2 border-border"},null,-1))])]),t("tbody",Se,[(r(!0),n(u,null,c(p(k)?.analytes,o=>(r(),n("tr",{key:o.uid},[e[21]||(e[21]=t("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-border"},null,-1)),t("td",Ve,[t("div",Ee,d(o?.name),1)]),(r(!0),n(u,null,c(o?.items,s=>(r(),n("td",{key:s.uid,class:"px-1 py-1 whitespace-no-wrap border-b border-border"},[t("div",$e,[t("div",null,[t("div",Ie,d(s?.sample?.qcLevel?.level),1),t("div",Ae,"("+d(s?.status)+")",1),b(t("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":a=>s.checked=a,onChange:e[2]||(e[2]=a=>O()),disabled:z(s)},null,40,Ne),[[Q,s.checked]])]),t("div",De,[t("div",Te,[e[16]||(e[16]=t("h4",{class:"w-28"},"Instrument",-1)),_(s)?(r(),n("label",Le,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>s.laboratoryInstrumentUid=a,onChange:a=>f(s)},[e[15]||(e[15]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(s.analysis?.instruments,a=>(r(),n(u,{key:a.uid},[(r(!0),n(u,null,c(a.laboratoryInstruments,w=>(r(),n("option",{key:w.uid,value:w.uid},d(w.labName)+" → ("+d(a?.name)+") ",9,Ke))),128))],64))),128))],40,Be),[[U,s.laboratoryInstrumentUid]])])):(r(),n("div",qe,d(s.laboratoryInstrument?.labName),1))]),t("div",Pe,[e[18]||(e[18]=t("h4",{class:"w-28"},"Method",-1)),_(s)?(r(),n("label",Qe,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>s.methodUid=a,onChange:a=>f(s)},[e[17]||(e[17]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(s.analysis?.methods,a=>(r(),n("option",{key:a.uid,value:a.uid},d(a.name),9,Oe))),128))],40,je),[[U,s.methodUid]])])):(r(),n("div",Me,d(s.method?.name),1))]),t("div",ze,[e[20]||(e[20]=t("h4",{class:"w-28"},"Result",-1)),_(s)?s?.analysis?.resultOptions?.length>0?(r(),n("label",He,[b(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>s.result=a,onKeyup:a=>f(s)},null,40,We),[[W,s.result]])])):(r(),n("label",Xe,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":a=>s.result=a,onChange:a=>f(s)},[e[19]||(e[19]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(s?.analysis?.resultOptions,a=>(r(),n("option",{key:a.optionKey,value:a.value},d(a.value),9,Ge))),128))],40,Ye),[[U,s.result]])])):(r(),n("div",Fe,d(s?.result),1))])])])]))),128))]))),128))])])])])):(r(),n("section",Je,[t("div",Ze,[t("table",et,[t("thead",null,[t("tr",null,[t("th",tt,[b(t("input",{type:"checkbox",onChange:e[3]||(e[3]=o=>ee()),"onUpdate:modelValue":e[4]||(e[4]=o=>he(g)?g.value=o:g=o)},null,544),[[Q,p(g)]])]),e[22]||(e[22]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},null,-1)),e[23]||(e[23]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left leading-4 text-foreground tracking-wider"},"Analysis",-1)),e[24]||(e[24]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Methods",-1)),e[25]||(e[25]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Instrument ",-1)),e[26]||(e[26]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Analyst",-1)),e[27]||(e[27]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Reviewer",-1)),e[28]||(e[28]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Interims ",-1)),e[29]||(e[29]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Result",-1)),e[30]||(e[30]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Retest",-1)),e[31]||(e[31]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Submitted",-1)),e[32]||(e[32]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Reviewed",-1)),e[33]||(e[33]=t("th",{class:"px-1 py-1 border-b-2 border-border text-left text-sm leading-4 text-foreground tracking-wider"},"Status",-1)),e[34]||(e[34]=t("th",{class:"px-1 py-1 border-b-2 border-border"},null,-1))])]),t("tbody",st,[(r(!0),n(u,null,c(j(),o=>(r(),n("tr",{key:o.uid},[t("td",null,[b(t("input",{type:"checkbox",class:"","onUpdate:modelValue":s=>o.checked=s,onChange:e[5]||(e[5]=s=>O()),disabled:z(o)},null,40,ot),[[Q,o.checked]])]),e[39]||(e[39]=t("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-border"},null,-1)),t("td",rt,[t("div",nt,d(o.analysis?.name),1),t("div",lt,"("+d(o?.sample?.qcLevel?.level)+")",1)]),t("td",at,[_(o)?(r(),n("label",dt,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>o.laboratoryInstrumentUid=s,onChange:s=>f(o)},[e[35]||(e[35]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(o.analysis?.instruments,s=>(r(),n(u,{key:s.uid},[(r(!0),n(u,null,c(s.laboratoryInstruments,a=>(r(),n("option",{key:a.uid,value:a.uid},d(a.labName)+" → ("+d(s?.name)+") ",9,pt))),128))],64))),128))],40,ut),[[U,o.laboratoryInstrumentUid]])])):(r(),n("div",it,d(o.laboratoryInstrument?.labName||"---"),1))]),t("td",ct,[_(o)?(r(),n("label",mt,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>o.methodUid=s,onChange:s=>f(o)},[e[36]||(e[36]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(o.analysis?.methods,s=>(r(),n("option",{key:s.uid,value:s.uid},d(s.name),9,yt))),128))],40,ft),[[U,o.methodUid]])])):(r(),n("div",bt,d(o.method?.name),1))]),t("td",vt,[t("div",xt,d(`${o.submittedBy?.firstName??"--"} ${o.submittedBy?.lastName??"--"}`),1)]),t("td",ht,[t("div",gt,[(r(!0),n(u,null,c(o.verifiedBy,s=>(r(),n("span",{key:s.firstName,class:"ml-1"},d(`${s?.firstName??"--"} ${s?.lastName??"--"},`),1))),128))])]),t("td",kt,[!_(o)||o?.analysis?.interims?.length===0?(r(),n("div",_t," --- ")):(r(),n("label",wt,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>o.result=s,onChange:s=>f(o)},[e[37]||(e[37]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(o?.analysis?.interims,s=>(r(),n("option",{key:s.key,value:s.value},d(s.value),9,Ct))),128))],40,Ut),[[U,o.result]])]))]),t("td",Rt,[_(o)?o?.analysis?.resultOptions?.length===0?(r(),n("label",Vt,[b(t("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>o.result=s,onKeyup:s=>f(o)},null,40,Et),[[W,o.result]])])):(r(),n("label",$t,[b(t("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":s=>o.result=s,onChange:s=>f(o)},[e[38]||(e[38]=t("option",{value:""},null,-1)),(r(!0),n(u,null,c(o?.analysis?.resultOptions,s=>(r(),n("option",{key:s.optionKey,value:s.value},d(s.value),9,At))),128))],40,It),[[U,o.result]])])):(r(),n("div",St,d(o?.result),1))]),t("td",Nt,[t("div",Dt,[o?.retest?(r(),n("span",Tt,[A(i,{icon:"fa-check-circle"})])):(r(),n("span",qt,[A(i,{icon:"fa-times-circle"})]))])]),t("td",Lt,[t("div",Bt,d(p(X)(o?.dateSubmitted)),1)]),t("td",Kt,[t("div",Pt,d(p(X)(o?.dateVerified)),1)]),t("td",Mt,[t("button",Qt,d(o.status),1)]),e[40]||(e[40]=t("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-border text-sm leading-5"},null,-1))]))),128))])])])])),t("section",jt,[S(E.UPDATE,V.RESULT)&&p(I)?(r(),n("button",{key:0,onClick:e[6]||(e[6]=x(o=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Cancel ")):R("v-if",!0),S(E.UPDATE,V.RESULT)&&p(q)?(r(),n("button",{key:1,onClick:e[7]||(e[7]=x(o=>pe(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Re-Instate ")):R("v-if",!0),S(E.UPDATE,V.RESULT)&&p(I)?(r(),n("button",{key:2,onClick:e[8]||(e[8]=x(o=>de(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Submit ")):R("v-if",!0),S(E.UPDATE,V.RESULT)&&p(N)?(r(),n("button",{key:3,onClick:e[9]||(e[9]=x(o=>be(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Retract ")):R("v-if",!0),S(E.UPDATE,V.RESULT)&&p(D)?(r(),n("button",{key:4,onClick:e[10]||(e[10]=x(o=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Verify ")):R("v-if",!0),S(E.UPDATE,V.RESULT)&&p(T)?(r(),n("button",{key:5,onClick:e[11]||(e[11]=x(o=>me(),["prevent"])),class:"px-2 py-1 mr-2 border-primary border text-primary rounded-sm transition duration-300 hover:bg-primary hover:text-primary-foreground focus:outline-none"}," Retest ")):R("v-if",!0)])],64)}}}),Gt=ke(Ot,[["__file","/home/aurthurm/Documents/Development/felicity/felicity-lims/webapp/views/qcontrol/_id/QCSet.vue"]]);export{Gt as default};
